# 📋 任务系统使用指南

## 🎯 功能概述

任务系统已完整实现，包含以下核心功能：

### ✅ 已实现功能

1. **发布任务**
   - ✅ 用户自定义发布任务
   - ✅ 从大模型聊天记录导入任务（结构化输出）
   - ✅ 任务描述和奖励配置

2. **任务进度**
   - ✅ 任务进度条显示（0-100%）
   - ✅ 大模型根据每日战报自动更新任务进度
   - ✅ 进度颜色区分（绿色/蓝色/橙色/红色）

3. **完成任务**
   - ✅ 任务完成度评级（优秀/良好/普通/较差）
   - ✅ 根据评级发放奖励（优秀1.5倍，良好1.2倍）
   - ✅ 自动标记完成状态

## 🚀 使用说明

### 1. 发布任务

#### 方式一：手动创建
1. 进入"任务"页面
2. 填写任务信息：
   - 任务名称（必填）
   - 任务描述（可选）
   - 奖励属性（默认：自律能力）
   - 奖励经验（默认：10）
3. 点击"新增任务"

#### 方式二：从聊天记录导入
1. 在"对话"页面与AI聊天，提及任务相关内容
2. 进入"任务"页面
3. 点击"从聊天记录导入任务"
4. AI会自动提取任务信息并创建

**示例对话：**
```
用户：我今天要完成3道LeetCode题目，奖励10点计算机能力经验
AI：好的，我会帮你记录这个任务...
```

### 2. 查看任务进度

- 任务列表显示每个任务的完成进度（百分比）
- 进度条颜色：
  - 🟢 绿色：90%以上
  - 🔵 蓝色：70-89%
  - 🟠 橙色：50-69%
  - 🔴 红色：50%以下

### 3. 更新任务进度

#### 使用每日战报
1. 在"对话"页面点击"生成战报"
2. AI会根据您的聊天记录生成每日战报
3. 自动评估并更新所有进行中任务的进度
4. 如果任务进度达到100%，自动标记为完成

**战报示例：**
```
📊 每日战报

今天学习了2小时，完成了2道LeetCode题目...

📈 任务进度更新：
• 刷3道LeetCode: 67%
• 完成项目文档: 45%
```

### 4. 完成任务

1. 当任务进度达到100%或手动点击"完成任务"
2. 系统自动评级：
   - **优秀**：进度≥90%（奖励1.5倍）
   - **良好**：进度≥70%（奖励1.2倍）
   - **普通**：进度≥50%
   - **较差**：进度<50%
3. 根据评级发放奖励经验
4. 任务标记为已完成

## 📊 任务数据结构

```javascript
{
  id: 1234567890,              // 任务ID
  title: "刷3道LeetCode",      // 任务标题
  description: "任务描述",      // 任务描述（可选）
  rewardAttr: "计算机能力",     // 奖励属性
  rewardExp: 10,               // 基础奖励经验
  progress: 67,                // 完成进度（0-100）
  rating: null,                // 完成度评级
  done: false,                 // 是否完成
  createdAt: 1234567890,      // 创建时间
  completedAt: null,           // 完成时间
  source: "manual"             // 任务来源：manual | ai_import
}
```

## 🔧 API接口

### 1. 提取任务（从聊天记录）

**接口：** `POST /api/extract-tasks`

**请求：**
```json
{
  "messages": [
    {"role": "user", "content": "我要完成3道LeetCode"},
    {"role": "assistant", "content": "好的..."}
  ]
}
```

**响应：**
```json
{
  "code": 0,
  "data": {
    "tasks": [
      {
        "title": "完成3道LeetCode",
        "description": "",
        "rewardAttr": "计算机能力",
        "rewardExp": 10
      }
    ]
  }
}
```

### 2. 更新任务进度（根据战报）

**接口：** `POST /api/update-task-progress`

**请求：**
```json
{
  "dailyReport": "今天完成了2道LeetCode题目...",
  "tasks": [
    {"id": 123, "title": "刷3道LeetCode", "description": ""}
  ]
}
```

**响应：**
```json
{
  "code": 0,
  "data": {
    "progressUpdates": [
      {"id": 123, "progress": 67}
    ]
  }
}
```

## 💡 使用技巧

### 1. 任务命名建议
- 使用具体、可量化的目标
- 例如："刷3道LeetCode" 而不是 "学习编程"

### 2. 奖励配置建议
- 根据任务难度设置经验值
- 简单任务：5-10经验
- 中等任务：10-20经验
- 困难任务：20-50经验

### 3. 每日战报最佳实践
- 在一天结束时生成战报
- 详细描述完成的工作
- AI会根据描述准确评估进度

### 4. 任务导入技巧
- 在对话中明确提及任务目标
- 可以同时提及多个任务
- AI会自动识别并提取

## 🐛 常见问题

### Q1: 导入任务失败
**A:** 
- 检查后端服务是否启动
- 确认聊天记录中有任务相关内容
- 查看控制台错误信息

### Q2: 任务进度不更新
**A:**
- 确保有进行中的任务
- 检查每日战报内容是否详细
- 确认后端API正常工作

### Q3: 评级不准确
**A:**
- 评级基于任务完成进度
- 进度≥90%为优秀，≥70%为良好
- 可以在完成任务时手动调整

## 📝 更新日志

- v1.0.0 - 初始版本
  - ✅ 基础任务管理
  - ✅ 进度显示
  - ✅ 评级系统
  - ✅ AI导入功能
  - ✅ 战报更新进度

---

**提示**：任务系统已完全集成到应用中，可以立即开始使用！

